<!doctype html>
<div id="penguins"></div>
<nav>
    <a href="/">Aller à la page d'accueil</a>
    <a href="/simple">Aller à la page simple</a>
    <a href="/penguinsFiltred">Aller à la page des filtres</a>
</nav>

<select name="species" id="species">
    <option value="">All species</option>
    <option value="Adelie">Adelie</option>
    <option value="Chinstrap">Chinstrap</option>
    <option value="Gentoo">Gentoo</option>
</select>
<select name="island" id="island">
    <option value="">All island</option>
    <option value="Biscoe">Biscoe</option>
    <option value="Dream">Dream</option>
    <option value="Torgersen">Torgersen</option>
</select>
<select name="sex" id="sex">
    <option value="">All sex</option>
    <option value="MALE">Male</option>
    <option value="FEMALE">Female</option>
</select>

<script>
    // Importe la librairie Plot d'ObservableHQ
    import * as Plot from "@observablehq/plot";
    // Importe les données des manchots depuis un fichier JSON
    import penguins from "../assets/penguins.json";

    // Récupère l'élément select pour choisir l'espèce
    const selectSpecies = document.querySelector("#species");
    const selectIsland = document.querySelector("#island");
    const selectSex = document.querySelector("#sex");

    // Fonction pour afficher le graphique
    function renderPlot() {
        // Récupère les valeurs sélectionnées
        const species = selectSpecies.value;
        const island = selectIsland.value;
        const sex = selectSex.value;

        // Sélectionne la div où le graphique sera affiché
        const div = document.querySelector("#penguins");
        // Vide le contenu précédent de la div
        div.innerHTML = "";

        // Filtrage des données selon les trois paramètres
        const data = penguins.filter((d) => {
            return (
                (species === "" || d.species === species) &&
                (island === "" || d.island === island) &&
                (sex === "" || d.sex === sex)
            );
        });

        // Crée le graphique avec Plot
        const plot = Plot.plot({
            marks: [
                Plot.dot(data, {
                    x: "culmen_length_mm",
                    y: "culmen_depth_mm",
                    stroke: "species",
                }),
            ],
        });
        // Ajoute le graphique à la div
        div.appendChild(plot);
    }

    // Ajoute un écouteur d'événement pour chaque filtre
    selectSpecies.addEventListener("change", renderPlot);
    selectIsland.addEventListener("change", renderPlot);
    selectSex.addEventListener("change", renderPlot);

    // Affiche le graphique au chargement de la page
    renderPlot();
</script>

<style>
    nav {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    nav a {
        display: block;
        padding: 5px;
        text-decoration: none;
    }
</style>